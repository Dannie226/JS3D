<!DOCTYPE html>
<html>
  <head>
    <title>Character Controller</title>
    <script src='../../libs/three.js'></script>
    <script src='../../libs/cannon.js'></script>
    <script src='../../libs/Orbit Controls.js'></script>
    <script src='../../build/JS3D.js'></script>
  </head>
  <body style='margin:0px;'>
  
  </body>
  <script>
  var world = new JS3D.World();
  world.cameras[0].position.set(0,5,10);
  world.cameras[0].lookAt(world.scene.position);
  var ground = new JS3D.BoxBody(new THREE.BoxBufferGeometry(100,2,100),new THREE.MeshPhongMaterial(),0,new JS3D.Vector3(0,-1,0));
  ground.mesh.recieveShadow = true;
  world.add(ground);
  world.renderer.shadowMap.enabled = true;
  var light = new THREE.DirectionalLight();
  light.castShadow = true;
  light.shadow.mapSize.width = 4096;
  light.shadow.mapSize.height = 4096;
  light.near = 0.5;
  light.far = 500;
  var v = {
      ve:145
  }
  light.shadow.camera.left = -v.ve/2;
  light.shadow.camera.right = v.ve/2;
  light.shadow.camera.top = v.ve/2;
  light.shadow.camera.bottom = -v.ve/2;
  light.position.set( -1, 1.75, 1 );
  light.position.multiplyScalar( 100 );
  world.scene.add(light);
  light.castShadow = true;
  var controls = new THREE.OrbitControls(world.cameras[0],world.renderer.domElement);
  var player = new JS3D.Character(1,2,1,new THREE.MeshPhongMaterial(),new JS3D.Vector3(0,5,0));
  player.mesh.castShadow = true;
  controls.target = player.mesh.position;
  world.add(player);
  var characterController = new JS3D.CharacterController(player,world.cameras[0],1/7.5);
  var move = characterController.moveDir;
  document.onkeydown = function(){
    switch(event.keyCode){
      case 87:
        move.forward = true;
        break;
      case 83:
        move.backward = true;
        break;
      case 65:
        move.left = true;
        break;
      case 68:
        move.right = true;
        break;
    }
  }
  document.onkeyup = function(){
    switch(event.keyCode){
      case 87:
        move.forward = false;
        break;
     case 83:
        move.backward = false;
        break;
    case 65:
        move.left = false;
        break;
    case 68:
        move.right = false;
        break;
      }
  }
  var animate = function(){
    requestAnimationFrame(animate);
    if(move.right){
      characterController.right();
    }else if(move.left){
      characterController.left();
    }
    if(move.forward){
      characterController.forward();
    }else if(move.backward){
      characterController.backward();
    }
    controls.update();
    world.update();
  }
  animate();
  </script>
</html>
